# Используем официальный образ Playwright, где уже есть Python и нужные зависимости
image: mcr.microsoft.com/playwright/python:v1.40.0-jammy

# Описываем этапы (стадии) нашего процесса
stages:
  - test
  - report

# Основное задание для запуска тестов
ui-tests:
  stage: test
  script:
    - pip install -r requirements.txt
    - playwright install chromium
    - pytest --alluredir=allure-results
  artifacts:
    when: always
    paths:
      - allure-results/
    expire_in: 1 week
  allow_failure: true

# Задание для генерации отчета (аналог GitHub Pages)
pages:
  stage: report
  dependencies:
    - ui-tests
  script:
    - pip install allure-pytest
    - # Здесь обычно настраивается генерация статического сайта, 
    - # но для начала нам важно увидеть, что тесты прошли
    - mkdir .public
    - cp -r allure-results/* .public
    - mv .public public
  artifacts:
    paths:
      - public
  only:
    - main